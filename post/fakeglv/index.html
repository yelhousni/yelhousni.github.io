<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Youssef El Housni">

  
  
  
    
  
  <meta name="description" content="From my Hackmd - hackmd.io/@yelhousni">

  
  <link rel="alternate" hreflang="en-us" href="../../post/fakeglv/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="../../css/academic.css">

  




  


  

  <link rel="manifest" href="../../index.webmanifest">
  <link rel="icon" type="image/png" href="../../img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="../../img/icon-192.png">

  <link rel="canonical" href="../../post/fakeglv/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="ŸäŸàÿ≥ŸÅ">
  <meta property="og:url" content="/post/fakeglv/">
  <meta property="og:title" content="Fake GLV | ŸäŸàÿ≥ŸÅ">
  <meta property="og:description" content="From my Hackmd - hackmd.io/@yelhousni"><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2024-09-20T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2024-09-20T00:00:00&#43;00:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/fakeglv/"
  },
  "headline": "Fake GLV",
  
  "datePublished": "2024-09-20T00:00:00Z",
  "dateModified": "2024-09-20T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "ŸäŸàÿ≥ŸÅ"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "ŸäŸàÿ≥ŸÅ",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "From my Hackmd - hackmd.io/@yelhousni"
}
</script>

  

  


  


  





  <title>Fake GLV | ŸäŸàÿ≥ŸÅ</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="../../">ŸäŸàÿ≥ŸÅ</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#experience"><span>Work</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#posts"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="../../#contact"><span>Contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Fake GLV</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Sep 20, 2024
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <pre tabindex="0"><code> _____     _           ____ _ __     __
|  ___|_ _| | _____   / ___| |\ \   / /
| |_ / _` | |/ / _ \ | |  _| | \ \ / /
|  _| (_| |   &lt;  __/ | |_| | |__\ V /
|_|  \__,_|_|\_\___|  \____|_____\_/
</code></pre><h2 id="you-dont-need-an-efficient-endomorphism-to-implement-glv-like-scalar-multiplication-in-snark-circuits">You don&rsquo;t need an efficient endomorphism to implement GLV-like scalar multiplication in SNARK circuits</h2>
<ul>
<li><a href="../../post/fakeglv/#Introduction">Introduction</a>
<ul>
<li><a href="../../post/fakeglv/#Other-applications">Other applications</a></li>
</ul>
</li>
<li><a href="../../post/fakeglv/#Background">Background</a></li>
<li><a href="../../post/fakeglv/#The-fake-GLV-trick6">The fake GLV trick</a>
<ul>
<li><a href="../../post/fakeglv/#Implementation7">Implementation</a>
<ul>
<li><a href="../../post/fakeglv/#Benchmark">Benchmark</a></li>
<li><a href="../../post/fakeglv/#Comparison">Comparison</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>P-256, also known as secp256r1 and prime256v1, is a 256-bit prime field Weierstrass curve standardized by the NIST. It is widely adopted in internet systems, which explains its myriad use cases in platforms such as TLS, DNSSEC, Apple‚Äôs Secure Enclave, Passkeys, Android Keystore, and Yubikey. The key operation in elliptic curves based cryptography is the scalar multiplication. When the curve is equipped with an efficient endomorphism it is possible to speed up this operation through the well-known <a href="https://www.iacr.org/archive/crypto2001/21390189.pdf">GLV</a> algorithm. P-256 does unfortunately not have an efficient endomorphism (see <a href="https://neuromancer.sk/std/nist/P-256">parameters</a>) to enjoy this speedup.</p>
<p>Verifying ECDSA signatures on Ethereum through precompiled contracts, i.e. smart contracts built into the Ethereum protocol (there are only 9) is only possible with the <em>secp256k1</em> curve and not the P-256.
Verifying ECDSA signatures on P-256 requires computing scalar multiplications in Solidity and is especially useful for smart-contract wallets, enabling hardware-based signing keys and safer, easier self-custody. Different solutions can bring P-256 signatures on-chain. There are primarily three interesting approaches: (zk)-SNARK based verifiers, smart contract verifiers (e.g. <a href="https://eprint.iacr.org/2023/939.pdf">[Dubois23]</a>, <a href="#ZgotmplZ">Ledger/FCL</a> (deprecated), <a href="https://github.com/get-smooth/crypto-lib">smoo.th/SCL</a> and <a href="https://daimo.com/blog/p256verifier">daimo/p256verifier</a>), and native protocol precompiles (<a href="https://github.com/ethereum/RIPs/blob/master/RIPS/rip-7212.md">EIP/RIP 7212</a>).</p>
<p>Using SNARK (succinctness) properties, provides a great way to reduce gas cost for computation on Ethereum (e.g. ~232k gas for <a href="https://eprint.iacr.org/2016/260.pdf">Groth16</a>, ~285k gas for <a href="https://eprint.iacr.org/2019/953.pdf">PLONK</a> and ~185k gas for <a href="https://eprint.iacr.org/2021/1167">FFLONK</a>). This is very competitive with (and sometimes better that) the currently gas-optimal smart contract verifier. Moreover one can batch many ECDSA verifications in a single proof, amortizing thus the gas cost. However verifying P-256 signatures in a SNARK circuit can be very expensive i.e. long proving time. This is because the field where the points on the P-256 curve lie is different than the field where the SNARK computation is usually expressed. To be able to verify the proof onchain through the procompile the SNARK field needs to be the <a href="https://hackmd.io/@jpw/bn254">BN254</a> scalar field. Different teams tried to implement the ECDSA verification on P-256 in a BN254 SNARK circuit efficiently. Among these: <a href="https://github.com/zkwebauthn/webauthn-halo2">zkwebauthn/webauthn-halo2</a>, <a href="https://github.com/zkwebauthn/webauthn-circom">https://github.com/zkwebauthn/webauthn-circom</a> and <a href="https://github.com/privacy-scaling-explorations/circom-ecdsa-p256">PSE/circom-ecdsa-p256</a>.</p>
<p><em>If P-256 had an efficient endomorphism we could have optimized the proving time a great deal!</em></p>
<p>In this note we show a way to implement a GLV-like scalar multiplications in-circuit without having an efficient endomorphism.</p>
<h3 id="other-applications">Other applications</h3>
<ul>
<li>This technique can be applied to any elliptic curve without an efficient endomorphism (e.g. <a href="https://en.wikipedia.org/wiki/Curve25519">Curve25519</a>, <a href="https://en.wikipedia.org/wiki/P-384">P-384</a>, MNT-753 (<a href="https://coinlist.co/build/coda/pages/MNT4753">k=4</a>, <a href="https://coinlist.co/build/coda/pages/MNT6753">k=6</a>), <a href="https://docs.starknet.io/architecture-and-concepts/cryptography/stark-curve/">STARK curve</a>, <a href="https://eprint.iacr.org/2024/869">$\mathcal{B}$ of &ldquo;cycle5&rdquo;</a>, &hellip;). See this <a href="https://neuromancer.sk/std/">database</a> for other curves.</li>
<li>This would question the choice of <a href="https://eprint.iacr.org/2021/1152">Bandersnatch</a> (<em>an embedded endomorphism-equipped curve over BLS12-381</em>) over <a href="https://github.com/zkcrypto/jubjub">Jubjub</a> (<em>an embedded curve over BLS12-381 without endomorphism</em>) for <a href="https://verkle.info/">Ethereum Verkle trees</a>.</li>
<li>This can speedup ECDSA verification in <a href="https://docs.cairo-lang.org/hello_starknet/signature_verification.html">Starknet</a> and <a href="https://www.cairo-lang.org/">Cairo</a> (through the <a href="https://docs.starknet.io/architecture-and-concepts/cryptography/stark-curve/">STARK curve</a>).</li>
<li>This can speedup natively the folding step (√† la Nova) of Ed25519 signatures through the 2-cycles proposed <a href="https://moderncrypto.org/mail-archive/curves/2024/001050.html">here</a> by Aurore Guillevic.</li>
</ul>
<h2 id="background">Background</h2>
<h3 id="standard-scalar-multiplication">Standard scalar multiplication</h3>
<p>Let $E$ be an elliptic curve defined over the prime field $\mathbb{F}_p$ and let $r$ be a prime divisor of the curve order #$E(\mathbb{F}_p)$ (i.e. the number of points).
Let $s \in \mathbb{F}_r$ and $P(x,y) \in E(\mathbb{F}_p)$, we are interested in proving scalar multiplication $s\cdot P$ over the $r$-torsion subgroup of $E$, denoted $E[r]$ (i.e. the subset of points of order $r$).</p>
<p>The simplest algorithm is the standard left-to-right <em>double-and-add</em>:</p>
<pre tabindex="0"><code>INPUT: s = (s_{t‚àí1},..., s_1, s_0), P ‚àà E(Fp).
OUTPUT: sP.
1. Q ‚Üê ‚àû.
2. For i from t‚àí1 downto 0 do
    2.1 Q ‚Üê 2Q.
    2.2 If s_i = 1 then Q ‚Üê Q + P.
3. Return(Q).
</code></pre><p>If/else branching is not possible in SNARK circuits so this is replaced by constant window table lookups inside the circuit. This can be achieved using polynomials which vanish at the constants that aren‚Äôt being selected, i.e. a 1-bit table lookup <code>Q ‚Üê s_i * Q + (1 - s_i) * (Q+P)</code>. Hence this double-and-add algorithm requires $t$ doublings, $t$ additions and $t$ 1-bit table lookup.
This can be extended to <em>windowed</em> double-and-add, i.e. scanning more than a bit per iteration using larger window tables, but the multiplicative depth of the evaluation increases exponentially. We use affine coordinates for doubling/adding points because inverses cost as much as multiplications, i.e. instead of checking that $1/x$ is $y$ we provide $y$ out-circuit and check in-circuit that $x\cdot y = 1$. However since we start with $Q ‚Üê ‚àû$ it is infeasible to avoid conditional branching since affine formulas are incomplete. Instead, we scan the bits right-to-left and assume that the first bit <code>s_0</code> is 1 (so that we start at <code>Q ‚Üê P</code>), we double the input point <code>P</code> instead of the accumulator <code>Q</code> in this algorithm and finally conditionally subtract (using the 1-bit lookup) <code>P</code> if <code>s_0</code> was 0.</p>
<pre tabindex="0"><code>INPUT: s = (s_{t‚àí1},..., s_1, s_0), P ‚àà E(Fp).
OUTPUT: sP.
1. Q ‚Üê P.
2. For i from 1 to t‚àí1 do
    2.1 If s_i = 1 then Q ‚Üê Q + P.
    2.2 P ‚Üê 2P.
3. if s_0 = 0 then Q ‚Üê Q - P
4. Return(Q).
</code></pre><h3 id="glv-scalar-multiplication">GLV scalar multiplication</h3>
<p>However it is well known that if the curve is equipped with an efficient endomorphism then there exists a faster algorithm known as <a href="https://www.iacr.org/archive/crypto2001/21390189.pdf">[GLV]</a>.
:::info
<strong>Example 1 :</strong> suppose that $E$ has Complex Multiplication (CM) with discrimant $-D=-3$, i.e. $E$ is of the form $y^2=x^3+b$, with $b \in \mathbb{F}_p$. This is the case of <code>BN254</code>, <code>BLS12-381</code> and <code>secp256k1</code> elliptic curves used in Ethereum. There is an efficient endomorphism $\phi: E \rightarrow E$ defined by $(x,y)\mapsto (\omega x,y)$ (and $\mathcal{O} \mapsto \mathcal{O}$) that acts on $P \in E[r]$ as $\phi(P)=\lambda \cdot P$. Both $\omega$ and $\lambda$ are cube roots of unity in $\mathbb{F}_p$ and $\mathbb{F}_r$ respectively, i.e. $\omega^2+\omega+1 \equiv 0 \pmod p$ and $\lambda^2+\lambda+1 \equiv 0 \pmod r$.
:::
:::info
<strong>Example 2 :</strong> suppose that $E$ has Complex Multiplication (CM) with discrimant $-D=-8$, meaning that the endomorphism ring is $\mathbf{Z}[\sqrt{‚àí2}]$. This is the case of the <code>Bandersnatch</code> elliptic curves specified in Ethereum Verkle trie. There is an efficient endomorphism $\phi: E \rightarrow E$ whose kernel is generated by a 2-torsion point. The map can be found by looking at 2-isogeneous curves and applying V√©lu&rsquo;s formulas. For Bandersnatch it is defined by $(x,y)\mapsto (u^2\cdot \frac{x^2+wx+t}{x+w},u^3\cdot y\cdot \frac{x^2+2wx+v}{(x+w)^2})$ for some constants $u,v,w,t$ (and $\mathcal{O} \mapsto \mathcal{O}$) that acts on $P \in E[r]$ as $\phi(P)=\lambda \cdot P$ where $\lambda^2+2 \equiv 0 \pmod r$.
:::
The GLV algorithm starts by decomposing $s$ as $s = s_0 + \lambda s_1$ and then replacing the scalar multiplication $s \cdot P$ by $s_0 \cdot P + s_1 \cdot \phi(P)$. Because $s_0$ and $s_1$ are guaranteed to be $\leq \sqrt{r}$ (see Sec.4 of <a href="https://www.iacr.org/archive/crypto2001/21390189.pdf">[GLV]</a> and Sec.4 of <a href="https://eprint.iacr.org/2015/565.pdf">[FourQ]</a> for an optimization trick), we can halve the size of the for loop in the double-and-add algorithm. We can then scan simultaenously the bits of $s_0$ and $s_1$ and apply the <a href="https://crypto.stackexchange.com/questions/99975/strauss-shamir-trick-on-ec-multiplication-by-scalar">Strauss-Shamir trick</a>. This results in a significant speed up but only when an endomorphism is available. For example the left-to-right double-and-add would become:</p>
<pre tabindex="0"><code>INPUT: s and P ‚àà E(Fp).
OUTPUT: sP.
1. Find s1 and s2 s.t. s = s1 + ùúÜ * s2 mod r
    1.1 let s1 = (s1_{t‚àí1},..., s1_1, s1_0)
    1.2 and s2 = = (s2_{t‚àí1},..., s2_1, s2_0)
2. P1 ‚Üê P, P2 ‚Üê ùúô(P) and Q ‚Üê ‚àû.
3. For i from t‚àí1 downto 0 do
    3.1 Q ‚Üê 2Q.
    3.2 If s1_i = 0 and s2_i = 0 then Q ‚Üê Q.
    3.3 If s1_i = 1 and s2_i = 0 then Q ‚Üê Q + P1.
    3.4 If s1_i = 0 and s2_i = 1 then Q ‚Üê Q + P2.
    3.5 If s1_i = 1 and s2_i = 1 then Q ‚Üê Q + P1 + P2.
4. Return(Q).
</code></pre><p>Using the efficient endomorphism in-circuit is also possible (see <a href="https://eprint.iacr.org/2019/1021.pdf">[Halo, Sec. 6.2 and Appendix C]</a> or <a href="https://github.com/Consensys/gnark/blob/ea53f373f45d2f9ad9cc1639c34359a35f771191/std/algebra/emulated/sw_emulated/point.go#L530">[gnark implementation]</a> for short Weierstrass curves and <a href="https://github.com/zhenfeizhang/bandersnatch-glv">[arkworks]</a> and <a href="https://github.com/Consensys/gnark/blob/master/std/algebra/native/twistededwards/scalarmul_glv.go">[gnark]</a> implementations for twisted Edwards). But one should be careful about some extra checks of the decomposition $s = s_0 + \lambda s_1 \mod r$ (not the SNARK modulus). The integers $s_0, s_1$ can possibly be negative in which case they will be reduced in-circuit modulo the SNARK field and not $r$.</p>
<h2 id="the-fake-glv-trick">The fake GLV trick</h2>
<p>Remember that we are proving that $s\cdot P = Q$ and not computing it. We can &ldquo;hint&rdquo; the result $Q$ and check in-circuit that $s\cdot P - Q = \mathcal{O}$. Now, if we can find $u,v \leq \sqrt{r}$ such that $v\cdot s = u \pmod r$ then we can check instead that
$$ (v\cdot s)\cdot P - v\cdot Q = \mathcal{O}$$
which is equivalent to
$$ u\cdot P - v\cdot Q = \mathcal{O}$$
The thing now is that $u$ and $v$ are &ldquo;small&rdquo; and we can, similarly to the GLV algorithm, halve the size of the double-and-add loop and apply the Strauss-Shamir trick.</p>
<p><strong>Solution</strong>: running the half-GCD algorithm (i.e. running GCD half-way) is sufficient to find $u$ and $v$. We can apply the exact same trick for finding the lattice basis as in the GLV paper (Sec. 4). For completeness we recall the algorithm hereafter.
We apply the extended Euclidean algorithm to find the greatest common divisor of $r$ and $s$ (This gcd is 1 since $r$ is prime.) The algorithm produces a sequence of equations
$$w_i \cdot r + v_i \cdot s = u_i$$
for $i = 0, 1, 2, \dots$  where $w_0 = 1, v_0 = 0, u_0 = r, w_1 = 0, v_1 = 1, u_1 = s$, and $u_i \geq 0$ for all $i$. We stop at the index $m$ for which $u_m \geq \sqrt{r}$ and take $u = u_{m+1}$ and $v = -v_{m+1}$.
<em>Note:</em> By construction $u$ is guaranteed to be a positive integer but $v$ can be negative, in which case it would be reduced in-circuit modulo the SNARK modulus and not $r$. To circumvent this we return in the hint $u$, $v$ and a $\texttt{b}=1$ if $v$ is negative and $\texttt{b}=0$ otherwise. In-circuit we negate $Q$ instead when $\texttt{b}=1$.</p>
<h3 id="implementation">Implementation</h3>
<p>A generic implementation in the gnark library is available at <a href="https://github.com/Consensys/gnark/feat/fake-GLV">gnark.io (feat/fake-GLV branch)</a>. For Short Weierstrass (e.g. P256) look at the <code>scalarMulFakeGLV</code> <a href="https://github.com/Consensys/gnark/blob/62c89cb10cff1413e9d68cce054c7e711d04c726/std/algebra/emulated/sw_emulated/point.go#L1263">method</a> in the emulated package and for twisted Edwards (e.g. Bandersnatch/Jubjub) look at the <code>scalarMulFakeGLV</code> <a href="https://github.com/Consensys/gnark/blob/62c89cb10cff1413e9d68cce054c7e711d04c726/std/algebra/native/twistededwards/point.go#L261">method</a> in the native package.</p>
<h4 id="benchmark">Benchmark</h4>
<p>The best algorithm to implement scalar multiplication in a non-native circuit (i.e. circuit field ‚â† curve field) when an efficient endomorphism is <em>not</em> available is an adaptation of <a href="https://www.iacr.org/archive/ches2007/47270135/47270135.pdf">[Joye07]</a> (implemented in <a href="https://github.com/Consensys/gnark/blob/fdb2b0de422b1c4fc5c6d08e81e788095ac818a6/std/algebra/emulated/sw_emulated/point.go#L748">gnark here</a>).
Next we compare this scalar multiplication with our fake GLV in a PLONKish vanilla (i.e. no custom gates) circuit (scs) over the BN254 curve (Ethereum compatible). We also give benchmarks in R1CS.</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">P-256</th>
          <th style="text-align: center">Old (Joye07)</th>
          <th style="text-align: right">New (fake GLV)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">$[s]P$</td>
          <td style="text-align: center">738,031 scs / 186,466 r1cs</td>
          <td style="text-align: right">385,412 scs / 100,914 r1cs</td>
      </tr>
      <tr>
          <td style="text-align: left">ECDSA verification</td>
          <td style="text-align: center">1,135,876 scs / 293,814 r1cs</td>
          <td style="text-align: right">742,541 scs / 195,266 r1cs</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>Note here that the old ECDSA verification uses Strauss-Shamir trick for computing $[s]P+[t]Q$ while the new version is merely two fake GLV multiplications and an addition.</p></blockquote>
<h4 id="comparison">Comparison</h4>
<p><a href="https://www.p256wallet.org/">p256wallet.org</a> is an ERC-4337 smart contract wallet that leverages zk-SNARKs for WebAuthn and P-256 signature verification. It uses <a href="https://github.com/privacy-scaling-explorations/circom-ecdsa-p256">PSE/circom-ecdsa-p256</a> to generate the webAuthn proof, and underneath <a href="https://github.com/privacy-scaling-explorations/circom-ecdsa-p256">PSE/circom-ecdsa-p256</a> to generate the ECDSA proof on P-256 curve. The github README reports <code>1,972,905 R1CS</code>. Compiling our circuit in R1CS results in <strong><code>195,266 R1CS</code></strong>. This is more than a <strong>10x</strong> reduction, which is not only due to the fake GLV algorithm but also to optimized non-native field arithmetic in gnark.</p>
<h4 id="other-curves">Other curves</h4>
<p>Similar results are noticed for other curves in short Weirstrass, e.g. P-384 and STARK curve:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">P-384</th>
          <th style="text-align: center">Old (Joye07)</th>
          <th style="text-align: right">New (fake GLV)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">$[s]P$</td>
          <td style="text-align: center">1,438,071 scs</td>
          <td style="text-align: right">782,674 scs</td>
      </tr>
      <tr>
          <td style="text-align: left">ECDSA verification</td>
          <td style="text-align: center">2,174,027 scs</td>
          <td style="text-align: right">1,419,929 scs</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th style="text-align: left">STARK curve</th>
          <th style="text-align: center">Old (Joye07)</th>
          <th style="text-align: right">New (fake GLV)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">$[s]P$</td>
          <td style="text-align: center">727,033 scs</td>
          <td style="text-align: right">380,210 scs</td>
      </tr>
      <tr>
          <td style="text-align: left">ECDSA verification</td>
          <td style="text-align: center">1,137,459 scs</td>
          <td style="text-align: right">732,131 scs</td>
      </tr>
  </tbody>
</table>
<p>and also in twisted Edwards e.g. Jubjub vs. Bandersnatch:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Jubjub</th>
          <th style="text-align: center">Old (2-bit double-and-add)</th>
          <th style="text-align: right">New (fake GLV)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">$[s]P$</td>
          <td style="text-align: center">5,863 scs / 3,314 r1cs</td>
          <td style="text-align: right">4,549  scs / 2,401 r1cs</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Bandersnatch</th>
          <th style="text-align: center">Old (GLV)</th>
          <th style="text-align: right">New (fake GLV)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">$[s]P$</td>
          <td style="text-align: center">4,781 scs /  2,455 r1cs</td>
          <td style="text-align: right">4,712 scs / 2,420 r1cs</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>EDIT: Thanks to Ben Smith for reporting that a similar idea was proposed in [SAC05:ABGL+] for ECDSA verification. We note that, in our context, the trick applies to a single scalar multiplication and that the half GCD is free through the hint.</p></blockquote>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=../../post/fakeglv/&amp;text=Fake%20GLV" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/fakeglv/&amp;t=Fake%20GLV" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=../../post/fakeglv/&amp;title=Fake%20GLV" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>












  














  
  



  </div>
</article>

      

    
    
    
    <script src="../../js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="../../js/academic.min.01f68d44d80310e669a1731b68a35481.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    2025 Youssef El Housni ¬©

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
